openapi: 3.0.3
info:
  title: Builder API
  version: 1.0.0
  description: API documentation for the Builder backend (accounts, items, item categories, maps).
servers:
  - url: http://localhost:5001

components:
  schemas:
    SignupRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
    SigninRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
    AccountResponse:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
    Item:
      type: object
      properties:
        id:
          type: string
        category:
          type: object
          properties:
            id:
              type: string
            name:
              type: string
        name:
          type: string
        description:
          type: string
        price:
          type: number
          format: float
        sizeX:
          type: integer
        sizeY:
          type: integer
        imageUrl:
          type: string
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    ItemCategory:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
    AccountDetail:
      type: object
      properties:
        id:
          type: string
        gameName:
          type: string
        chron:
          type: number
        exp:
          type: number
        createdAt:
          type: string
          format: date-time
    GameNameUpdate:
      type: object
      required: [gameName]
      properties:
        gameName:
          type: string
    Map:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        account:
          type: object
          properties:
            id:
              type: string
        widthTiles:
          type: integer
        heightTiles:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    PlacementSimplified:
      type: object
      properties:
        id:
          type: string
        x:
          type: integer
        y:
          type: integer
        item:
          type: object
          properties:
            id:
              type: string
            name:
              type: string
            imageUrl:
              type: string
            sizeX:
              type: integer
            sizeY:
              type: integer
            price:
              type: number
              format: float
        placedBy:
          type: object
          properties:
            id:
              type: string
        placedAt:
          type: string
          format: date-time
    MapWithGrid:
      type: object
      properties:
        map:
          $ref: '#/components/schemas/Map'
        grid:
          type: array
          description: "2D array (rows = Y) of placement objects or null for empty tiles"
          items:
            type: array
            items:
              anyOf:
                - $ref: '#/components/schemas/PlacementSimplified'
                - type: 'null'

paths:
  /api/account/signup:
    post:
      tags: [account]
      summary: Create a new account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SignupRequest"
      responses:
        "201":
          description: Account created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  account:
                    $ref: "#/components/schemas/AccountResponse"
        "400":
          description: Validation error

  /api/account/signin:
    post:
      tags: [account]
      summary: Sign in and receive tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SigninRequest"
      responses:
        "200":
          description: Signed in
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  account:
                    $ref: "#/components/schemas/AccountResponse"
                  tokens:
                    type: object
                    properties:
                      access:
                        type: string
                      refresh:
                        type: string

  /api/items:
    get:
      tags: [items]
      summary: List active items (shop)
      parameters:
        - in: query
          name: page
          schema:
            type: integer
        - in: query
          name: limit
          schema:
            type: integer
      responses:
        "200":
          description: Paginated items
          content:
            application/json:
              schema:
                type: object
                properties:
                  page:
                    type: integer
                  limit:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Item"
    post:
      tags: [items]
      summary: Create an item
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                category:
                  type: string
                name:
                  type: string
                description:
                  type: string
                price:
                  type: number
                sizeX:
                  type: integer
                sizeY:
                  type: integer
                imageUrl:
                  type: string
      responses:
        "201":
          description: Created item
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Item"

  /api/items/{id}:
    get:
      tags: [items]
      summary: Get item by id
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Item
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Item"
        "404":
          description: Not found
    put:
      tags: [items]
      summary: Update item
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        "200":
          description: Updated item
    delete:
      tags: [items]
      summary: Soft-delete item (sets isActive=false)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Soft deleted

  /api/item-categories:
    get:
      tags: [categories]
      summary: List item categories
      parameters:
        - in: query
          name: page
          schema:
            type: integer
        - in: query
          name: limit
          schema:
            type: integer
      responses:
        "200":
          description: Paginated categories
    post:
      tags: [categories]
      summary: Create a category
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                description:
                  type: string
      responses:
        "201":
          description: Created

  /api/item-categories/{id}:
    get:
      tags: [categories]
      summary: Get category by id
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Category
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ItemCategory"
        "404":
          description: Not found
    put:
      tags: [categories]
      summary: Update category
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        "200":
          description: Updated
    delete:
      tags: [categories]
      summary: Soft-delete category (isActive=false)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Soft deleted
  /api/account-detail/account/{accountId}/game-name:
    put:
      tags: [account]
      summary: Update account detail's gameName by account id
      parameters:
        - in: path
          name: accountId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GameNameUpdate"
      responses:
        "200":
          description: Updated account detail
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  accountDetail:
                    $ref: "#/components/schemas/AccountDetail"
        "404":
          description: Account or detail not found

  /api/account-detail/{id}/game-name:
    put:
      tags: [account]
      summary: Update account detail's gameName by detail id
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GameNameUpdate"
      responses:
        "200":
          description: Updated account detail
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  accountDetail:
                    $ref: "#/components/schemas/AccountDetail"
        "404":
          description: Not found

  /api/maps/{id}:
    get:
      tags: [maps]
      summary: Get map by id along with a 2D tile grid
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Map with tile grid
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MapWithGrid"
        "404":
          description: Map not found

tags:
  - name: account
  - name: items
  - name: categories
  - name: maps
